<!DOCTYPE html>
<html>
  <head>
    <% include ./partials/head %>
    <link rel='stylesheet' href='/stylesheets/blog.css' />
    <meta property="og:title"/>
    <meta property="og:description"/>
    <meta property="og:image"/>
    <meta property="og:image:type"         content="image/png">
    <meta property="og:image:width"        content="1200" />
    <meta property="og:image:height"       content="1200" />
    <link href='http://fonts.googleapis.com/css?family=Raleway:300,400' rel='stylesheet' type='text/css'/>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet' type='text/css'/>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'/>
  </head>
  <body>

    <% include ./partials/blog_header.ejs %>

    <div class="container main_wrapper">
      <div class="row">
        <div class="main_wrapper_bg eight columns">
          <div class="content_wrapper">
          <% if (user) { %>
            <p class="openPostForm">New post</p>
            <div class="formErrors"></div>
            <form method="post" action="/blog" id="blogForm">
              <input type="text" id="title" placeholder="Title" name="title"><br>
              <textarea id="body" placeholder="Share your insights" name="body"></textarea><br>
              <input type="text" id="tags" name="tags">
              <input type="file" name="image" class="editFile">
              <img id="preview" height="100" />
              <p class="removePostPreview">X</p>
              <button class="submitPost">Submit</button>
            </form>
            <% } %>
            <p class="all_posts back">Back to all posts</p>
            <div class="posts">
              <% posts.forEach(function(post){ %>
              <div class="post" data-id= <%= post.id %>>
                <div class="postData">
                  <p class="postDate">
                    <% var date = new Date(post.date); date = date.toDateString() %>
                    <%= date %>
                  </p>
                  <a  href="/posts/<%= post.id %>" class="postTitle"><%= post.title %></a>
                  <img
                  <% if (post.image.url) { %>
                    src="<%= post.image.url%>"
                  <% } %>
                  class="postImage" id="preview">
                  <div class="post_body_wrap">
                    <% var maxLength = 700; %>
                    <% if (post.body.length > maxLength) {
                      var trimmedString = post.body.substr(0, maxLength);
                      var trimmedString = trimmedString.substr(0, Math.min(trimmedString.length, trimmedString.lastIndexOf(" "))) %>
                    <p class="postBody"><%= trimmedString %> ...</p>
                    <div class="read_more_wrap">
                      <a href="/posts/<%= post.id %>" class="readMore">READ MORE</a>
                    </div>
                     <% } else { %>
                    <p class="postBody"><%= post.body %></p>
                    <% } %>
                  </div><!--post_body_wrap-->
                    <p class="postTags">
                      <% if (post.tags[0] !== "") { %>
                        <img src="/images/tag.png" width="20px">
                      <% } %>
                      <% post.tags.forEach(function(tag){ %>
                        <span class="searchTag"><%= tag %></span>
                      <% }) %>
                    </p>
                </div><!--postData-->
                <a href="/posts/<%=post.id%>" class="comment_link">Comments (<%= post.comments.length %>)</a>
                <% if (user) { %>
                <div class="edit_delete_wrapper">
                  <p class="deletePost">Delete</p>
                  <p class="openEdit">Edit</p>
                  <div class="edit">
                    <form id="editPostForm">
                      <% if (post.image.url) { %>
                        <button class="openChangeImage">Change Image</button>
                        <div class="changeImageInput">
                          <button class="removeEditPreview">Remove preview</button>
                          <input type="file" name="image" class="editFile">
                          <button class="changeImage">Submit Image</button>
                        </div><!--changeImageInput-->
                          <button class="deleteImage">Delete Image</button>
                      <% } else { %>
                        <input type="file" name="image" class="editFile">
                        <p class="removePreview">X</p>
                      <% } %>
                      <input type="text" name="editPostTitle" value="<%=post.title %>" class="editPostTitle">
                      <textarea name="editPostBody" class="editPostBody"><%= post.body %></textarea>
                      <input type="text" name="editPostTags" class="editPostTags" value="<%= post.tags.join(', ') %>">
                      <button class="editPost">Submit</button>
                    </form>
                  </div><!--edit-->
                </div><!--edit_delete_wrapper-->
                <% } %>
              </div><!--post-->
            <% }) %>
            </div><!--posts-->
            <div class="pages" data-id="<%= totalPosts %>">
              <p class="newerPosts">Newer posts</p>
              <% if (posts.length === 10) { %>
                <p class="olderPosts">Older posts</p>
              <% } %>
              <p class="olderSearchPosts">Older Posts</p>
              <p class="newerSearchPosts">Newer Posts</p>
              <div class="tagPagination">
                <p class="olderTagPosts">Older Posts</p>
                <p class="newerTagPosts">Newer Posts</p>
              </div><!--tagPagination-->
            </div><!--pages-->

          </div><!--content_wrapper-->
        </div><!--main_wrapper_bg-->


        <div class="right_sidebar_wrapper four columns">
          <div class="right_sidebar section">

            <% include ./partials/side_bar %>
          </div><!--right_sidebar section-->
        </div><!--right_sidebar_wrapper four columns-->


      </div><!--row-->
    </div><!--container main_wrapper-->


    <script src="/javascripts/highlight.js"></script>
    <script src="/javascripts/functionality.js"></script>
    <script src="/javascripts/beauty.js"></script>

  </body>
</html>
